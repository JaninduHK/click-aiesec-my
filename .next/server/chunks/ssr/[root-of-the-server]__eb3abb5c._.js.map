{"version":3,"sources":["../../../../src/components/Dashboard/ChartsView.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/dashboard/charts/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/Dashboard/ChartsView.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/Dashboard/ChartsView.tsx\",\n    \"default\",\n);\n","import { Metadata } from \"next\";\nimport { getServerSession } from \"next-auth\";\nimport { prisma } from \"@/utils/prismaDB\";\nimport { authOptions } from \"@/utils/auth\";\nimport ChartsView from \"@/components/Dashboard/ChartsView\";\n\nexport const metadata: Metadata = {\n  title: \"Charts | click.aiesec.my\",\n  description: \"Visual analytics and charts\",\n};\n\nexport default async function ChartsPage() {\n  const session = await getServerSession(authOptions);\n  const isAdmin = session?.user?.role === \"ADMIN\";\n  const whereLinks = isAdmin ? {} : { userId: session?.user?.id as string };\n  const clickWhere = isAdmin ? {} : { shortLink: { userId: session?.user?.id } };\n\n  const now = new Date();\n  const last30days = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n\n  // Get clicks over last 30 days grouped by date\n  const clicksByDate = isAdmin\n    ? await prisma.$queryRaw<Array<{ date: Date; count: bigint }>>`\n        SELECT DATE(\"createdAt\") as date, COUNT(*)::int as count\n        FROM \"ClickEvent\"\n        WHERE \"createdAt\" >= ${last30days}\n        GROUP BY DATE(\"createdAt\")\n        ORDER BY date ASC\n      `\n    : await prisma.$queryRaw<Array<{ date: Date; count: bigint }>>`\n        SELECT DATE(ce.\"createdAt\") as date, COUNT(*)::int as count\n        FROM \"ClickEvent\" ce\n        INNER JOIN \"ShortLink\" sl ON ce.\"shortLinkId\" = sl.id\n        WHERE ce.\"createdAt\" >= ${last30days}\n          AND sl.\"userId\" = ${session?.user?.id}\n        GROUP BY DATE(ce.\"createdAt\")\n        ORDER BY date ASC\n      `;\n\n  const [clicksByCountry, clicksByDevice, topLinks] = await Promise.all([\n    prisma.clickEvent.groupBy({\n      by: [\"country\"],\n      where: { ...clickWhere, country: { not: null }, createdAt: { gte: last30days } },\n      _count: true,\n      orderBy: { _count: { country: \"desc\" } },\n      take: 10,\n    }),\n    prisma.clickEvent.groupBy({\n      by: [\"device\"],\n      where: { ...clickWhere, device: { not: null }, createdAt: { gte: last30days } },\n      _count: true,\n      orderBy: { _count: { device: \"desc\" } },\n    }),\n    prisma.shortLink.findMany({\n      where: whereLinks,\n      take: 5,\n      orderBy: { clickEvents: { _count: \"desc\" } },\n      include: {\n        _count: { select: { clickEvents: true } },\n      },\n    }),\n  ]);\n\n  const chartsData = {\n    clicksOverTime: clicksByDate.map((item) => ({\n      date: item.date.toISOString().split(\"T\")[0],\n      clicks: Number(item.count),\n    })),\n    locationData: clicksByCountry.map((item) => ({\n      country: item.country || \"Unknown\",\n      clicks: item._count,\n    })),\n    deviceData: clicksByDevice.map((item) => ({\n      device: item.device || \"Unknown\",\n      clicks: item._count,\n    })),\n    topLinksData: topLinks.map((link) => ({\n      slug: link.slug,\n      title: link.title || link.slug,\n      clicks: link._count.clickEvents,\n    })),\n  };\n\n  return <ChartsView data={chartsData} />;\n}\n"],"names":[],"mappings":"qWAEe,CAAA,EAAA,AADf,EAAA,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,ySAA2S,EACxU,wEACA,8DAHW,CAAA,EADf,AACe,EADf,CAAA,CAAA,OACe,uBAAA,AAAuB,EAClC,WAAa,MAAM,AAAI,MAAM,qRAAuR,EACpT,oDACA,0ICJJ,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,kBAOe,eAAe,IAC5B,IAAM,EAAU,MAAM,CAAA,EAAA,EAAA,gBAAA,AAAgB,EAAC,EAAA,WAAW,EAC5C,EAAU,GAAS,MAAM,OAAS,QAClC,EAAa,EAAU,CAAC,EAAI,CAAE,OAAQ,GAAS,MAAM,EAAa,EAClE,EAAa,EAAU,CAAC,EAAI,CAAE,UAAW,CAAE,OAAQ,GAAS,MAAM,EAAG,CAAE,EAEvE,EAAM,IAAI,KACV,EAAa,IAAI,KAAK,EAAI,OAAO,GAAK,KAAK,GAG3C,EAHgD,AAGjC,EACjB,GAJuD,GAIjD,EAAA,AAJsD,MAIhD,CAAC,SAA+C,CAAC;;;6BAGtC,EAAE,EAAW;;;MAGpC,CAAC,CACD,MAAM,EAAA,MAAM,CAAC,SAA+C,CAAC;;;;gCAInC,EAAE,EAAW;4BACjB,EAAE,GAAS,MAAM,GAAG;;;MAG1C,CAAC,CAEC,CAAC,EAAiB,EAAgB,EAAS,CAAG,MAAM,QAAQ,GAAG,CAAC,CACpE,EAAA,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CACxB,GAAI,CAAC,UAAU,CACf,MAAO,CAAE,GAAG,CAAU,CAAE,QAAS,CAAE,IAAK,IAAK,EAAG,UAAW,CAAE,IAAK,CAAW,CAAE,EAC/E,QAAQ,EACR,QAAS,CAAE,OAAQ,CAAE,QAAS,MAAO,CAAE,EACvC,KAAM,EACR,GACA,EAAA,MAAM,CAAC,UAAU,CAAC,OAAO,CAAC,CACxB,GAAI,CAAC,SAAS,CACd,MAAO,CAAE,GAAG,CAAU,CAAE,OAAQ,CAAE,IAAK,IAAK,EAAG,UAAW,CAAE,IAAK,CAAW,CAAE,EAC9E,OAAQ,GACR,QAAS,CAAE,OAAQ,CAAE,OAAQ,MAAO,CAAE,CACxC,GACA,EAAA,MAAM,CAAC,SAAS,CAAC,QAAQ,CAAC,CACxB,MAAO,EACP,KAAM,EACN,QAAS,CAAE,YAAa,CAAE,OAAQ,MAAO,CAAE,EAC3C,QAAS,CACP,OAAQ,CAAE,OAAQ,CAAE,aAAa,CAAK,CAAE,CAC1C,CACF,GACD,EAEK,EAAa,CACjB,eAAgB,EAAa,GAAG,CAAC,AAAC,IAAU,CAC1C,EADyC,GACnC,EAAK,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAC3C,OAAQ,OAAO,EAAK,KAAK,EAC3B,CAAC,EACD,aAAc,EAAgB,GAAG,CAAC,AAAC,IAAU,CAC3C,EAD0C,MACjC,EAAK,OAAO,EAAI,UACzB,OAAQ,EAAK,MAAM,CACrB,CAAC,EACD,WAAY,EAAe,GAAG,CAAC,AAAC,IAAU,CACxC,EADuC,KAC/B,EAAK,MAAM,EAAI,UACvB,OAAQ,EAAK,MAAM,CACrB,CAAC,EACD,aAAc,EAAS,GAAG,CAAC,AAAC,IAAU,CACpC,EADmC,GAC7B,EAAK,IAAI,CACf,MAAO,EAAK,KAAK,EAAI,EAAK,IAAI,CAC9B,OAAQ,EAAK,MAAM,CAAC,WAAW,CACjC,CAAC,CACH,EAEA,MAAO,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,OAAU,CAAA,CAAC,KAAM,GAC3B,8DA9EkC,CAChC,MAAO,2BACP,YAAa,6BACf","ignoreList":[0]}