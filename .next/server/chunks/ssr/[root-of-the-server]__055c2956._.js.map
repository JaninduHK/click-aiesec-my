{"version":3,"sources":["../../../../src/components/Dashboard/AnalyticsDashboard.tsx/__nextjs-internal-proxy.mjs","../../../../src/app/dashboard/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/Dashboard/AnalyticsDashboard.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/Dashboard/AnalyticsDashboard.tsx\",\n    \"default\",\n);\n","import { Metadata } from \"next\";\nimport { getServerSession } from \"next-auth\";\nimport { prisma } from \"@/utils/prismaDB\";\nimport { authOptions } from \"@/utils/auth\";\nimport AnalyticsDashboard from \"@/components/Dashboard/AnalyticsDashboard\";\n\nexport const metadata: Metadata = {\n  title: \"Analytics | click.aiesec.my\",\n  description: \"Comprehensive analytics for your shortened links\",\n};\n\nexport default async function DashboardPage() {\n  const session = await getServerSession(authOptions);\n  const isAdmin = session?.user?.role === \"ADMIN\";\n  const whereLinks = isAdmin ? {} : { userId: session?.user?.id as string };\n  const clickWhere = isAdmin ? {} : { shortLink: { userId: session?.user?.id } };\n\n  const now = new Date();\n  const last24h = new Date(now.getTime() - 24 * 60 * 60 * 1000);\n  const last7days = new Date(now.getTime() - 7 * 24 * 60 * 60 * 1000);\n\n  const [\n    linkCount,\n    totalClicks,\n    uniqueClicks,\n    clicksLast24h,\n    uniqueClicksLast24h,\n    clicksLast7days,\n    topLinks,\n    clicksByCountry,\n    clicksByDevice,\n    clicksByBrowser,\n    clicksByOs,\n    recentClicks,\n  ] = await Promise.all([\n    prisma.shortLink.count({ where: whereLinks }),\n    prisma.clickEvent.count({ where: clickWhere }),\n    // Count unique clicks by distinct IP addresses\n    prisma.clickEvent.groupBy({\n      by: [\"ip\"],\n      where: { ...clickWhere, ip: { not: null } },\n    }).then((result) => result.length),\n    prisma.clickEvent.count({\n      where: { ...clickWhere, createdAt: { gte: last24h } },\n    }),\n    // Count unique clicks in last 24h by distinct IP addresses\n    prisma.clickEvent.groupBy({\n      by: [\"ip\"],\n      where: { ...clickWhere, ip: { not: null }, createdAt: { gte: last24h } },\n    }).then((result) => result.length),\n    prisma.clickEvent.count({\n      where: { ...clickWhere, createdAt: { gte: last7days } },\n    }),\n    prisma.shortLink.findMany({\n      where: whereLinks,\n      take: 10,\n      orderBy: { clickEvents: { _count: \"desc\" } },\n      include: {\n        _count: { select: { clickEvents: true } },\n      },\n    }),\n    prisma.clickEvent.groupBy({\n      by: [\"country\"],\n      where: { ...clickWhere, country: { not: null } },\n      _count: true,\n      orderBy: { _count: { country: \"desc\" } },\n      take: 10,\n    }),\n    prisma.clickEvent.groupBy({\n      by: [\"device\"],\n      where: { ...clickWhere, device: { not: null } },\n      _count: true,\n      orderBy: { _count: { device: \"desc\" } },\n    }),\n    prisma.clickEvent.groupBy({\n      by: [\"browser\"],\n      where: { ...clickWhere, browser: { not: null } },\n      _count: true,\n      orderBy: { _count: { browser: \"desc\" } },\n      take: 5,\n    }),\n    prisma.clickEvent.groupBy({\n      by: [\"os\"],\n      where: { ...clickWhere, os: { not: null } },\n      _count: true,\n      orderBy: { _count: { os: \"desc\" } },\n      take: 5,\n    }),\n    prisma.clickEvent.findMany({\n      where: clickWhere,\n      take: 20,\n      orderBy: { createdAt: \"desc\" },\n      include: {\n        shortLink: {\n          select: { slug: true, title: true },\n        },\n      },\n    }),\n  ]);\n\n  const analyticsData = {\n    overview: {\n      linkCount,\n      totalClicks,\n      uniqueClicks,\n      clicksLast24h,\n      uniqueClicksLast24h,\n      clicksLast7days,\n      avgClicksPerLink: linkCount > 0 ? Math.round(totalClicks / linkCount) : 0,\n    },\n    topLinks: topLinks.map((link) => ({\n      id: link.id,\n      slug: link.slug,\n      title: link.title || link.slug,\n      clicks: link._count.clickEvents,\n    })),\n    locations: clicksByCountry.map((item) => ({\n      country: item.country || \"Unknown\",\n      clicks: item._count,\n    })),\n    devices: clicksByDevice.map((item) => ({\n      device: item.device || \"Unknown\",\n      clicks: item._count,\n    })),\n    browsers: clicksByBrowser.map((item) => ({\n      browser: item.browser || \"Unknown\",\n      clicks: item._count,\n    })),\n    operatingSystems: clicksByOs.map((item) => ({\n      os: item.os || \"Unknown\",\n      clicks: item._count,\n    })),\n    recentActivity: recentClicks.map((click) => ({\n      id: click.id,\n      slug: click.shortLink.slug,\n      title: click.shortLink.title,\n      country: click.country,\n      city: click.city,\n      device: click.device,\n      browser: click.browser,\n      os: click.os,\n      timestamp: click.createdAt.toISOString(),\n    })),\n  };\n\n  return <AnalyticsDashboard data={analyticsData} />;\n}\n"],"names":[],"mappings":"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","ignoreList":[0]}