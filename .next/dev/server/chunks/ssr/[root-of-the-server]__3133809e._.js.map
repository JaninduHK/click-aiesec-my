{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 26, "column": 0}, "map": {"version":3,"sources":["file:///Users/janinduhansaka/Documents/click.aiesec.my/src/components/Dashboard/ChartsView.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/Dashboard/ChartsView.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/Dashboard/ChartsView.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAA2S,GACxU,yEACA","ignoreList":[0]}},
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/janinduhansaka/Documents/click.aiesec.my/src/components/Dashboard/ChartsView.tsx/__nextjs-internal-proxy.mjs"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/src/components/Dashboard/ChartsView.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/src/components/Dashboard/ChartsView.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":"AAAA,uEAAuE;;;;;AACvE;;uCACe,IAAA,wQAAuB,EAClC;IAAa,MAAM,IAAI,MAAM;AAAuR,GACpT,qDACA","ignoreList":[0]}},
    {"offset": {"line": 54, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":""}},
    {"offset": {"line": 64, "column": 0}, "map": {"version":3,"sources":["file:///Users/janinduhansaka/Documents/click.aiesec.my/src/app/dashboard/charts/page.tsx"],"sourcesContent":["import { Metadata } from \"next\";\nimport { getServerSession } from \"next-auth\";\nimport { prisma } from \"@/utils/prismaDB\";\nimport { authOptions } from \"@/utils/auth\";\nimport ChartsView from \"@/components/Dashboard/ChartsView\";\n\nexport const metadata: Metadata = {\n  title: \"Charts | click.aiesec.my\",\n  description: \"Visual analytics and charts\",\n};\n\nexport default async function ChartsPage() {\n  const session = await getServerSession(authOptions);\n  const isAdmin = session?.user?.role === \"ADMIN\";\n  const whereLinks = isAdmin ? {} : { userId: session?.user?.id as string };\n  const clickWhere = isAdmin ? {} : { shortLink: { userId: session?.user?.id } };\n\n  const now = new Date();\n  const last30days = new Date(now.getTime() - 30 * 24 * 60 * 60 * 1000);\n\n  // Get clicks over last 30 days grouped by date\n  const clicksByDate = isAdmin\n    ? await prisma.$queryRaw<Array<{ date: Date; count: bigint }>>`\n        SELECT DATE(\"createdAt\") as date, COUNT(*)::int as count\n        FROM \"ClickEvent\"\n        WHERE \"createdAt\" >= ${last30days}\n        GROUP BY DATE(\"createdAt\")\n        ORDER BY date ASC\n      `\n    : await prisma.$queryRaw<Array<{ date: Date; count: bigint }>>`\n        SELECT DATE(ce.\"createdAt\") as date, COUNT(*)::int as count\n        FROM \"ClickEvent\" ce\n        INNER JOIN \"ShortLink\" sl ON ce.\"shortLinkId\" = sl.id\n        WHERE ce.\"createdAt\" >= ${last30days}\n          AND sl.\"userId\" = ${session?.user?.id}\n        GROUP BY DATE(ce.\"createdAt\")\n        ORDER BY date ASC\n      `;\n\n  const [clicksByCountry, clicksByDevice, topLinks] = await Promise.all([\n    prisma.clickEvent.groupBy({\n      by: [\"country\"],\n      where: { ...clickWhere, country: { not: null }, createdAt: { gte: last30days } },\n      _count: true,\n      orderBy: { _count: { country: \"desc\" } },\n      take: 10,\n    }),\n    prisma.clickEvent.groupBy({\n      by: [\"device\"],\n      where: { ...clickWhere, device: { not: null }, createdAt: { gte: last30days } },\n      _count: true,\n      orderBy: { _count: { device: \"desc\" } },\n    }),\n    prisma.shortLink.findMany({\n      where: whereLinks,\n      take: 5,\n      orderBy: { clickEvents: { _count: \"desc\" } },\n      include: {\n        _count: { select: { clickEvents: true } },\n      },\n    }),\n  ]);\n\n  const chartsData = {\n    clicksOverTime: clicksByDate.map((item) => ({\n      date: item.date.toISOString().split(\"T\")[0],\n      clicks: Number(item.count),\n    })),\n    locationData: clicksByCountry.map((item) => ({\n      country: item.country || \"Unknown\",\n      clicks: item._count,\n    })),\n    deviceData: clicksByDevice.map((item) => ({\n      device: item.device || \"Unknown\",\n      clicks: item._count,\n    })),\n    topLinksData: topLinks.map((link) => ({\n      slug: link.slug,\n      title: link.title || link.slug,\n      clicks: link._count.clickEvents,\n    })),\n  };\n\n  return <ChartsView data={chartsData} />;\n}\n"],"names":[],"mappings":";;;;;;;AACA;AACA;AACA;AACA;;;;;;;;;;;AAEO,MAAM,WAAqB;IAChC,OAAO;IACP,aAAa;AACf;AAEe,eAAe;IAC5B,MAAM,UAAU,MAAM,IAAA,yJAAgB,EAAC,mIAAW;IAClD,MAAM,UAAU,SAAS,MAAM,SAAS;IACxC,MAAM,aAAa,UAAU,CAAC,IAAI;QAAE,QAAQ,SAAS,MAAM;IAAa;IACxE,MAAM,aAAa,UAAU,CAAC,IAAI;QAAE,WAAW;YAAE,QAAQ,SAAS,MAAM;QAAG;IAAE;IAE7E,MAAM,MAAM,IAAI;IAChB,MAAM,aAAa,IAAI,KAAK,IAAI,OAAO,KAAK,KAAK,KAAK,KAAK,KAAK;IAEhE,+CAA+C;IAC/C,MAAM,eAAe,UACjB,MAAM,kIAAM,CAAC,SAAS,AAAsC,CAAC;;;6BAGtC,EAAE,WAAW;;;MAGpC,CAAC,GACD,MAAM,kIAAM,CAAC,SAAS,AAAsC,CAAC;;;;gCAInC,EAAE,WAAW;4BACjB,EAAE,SAAS,MAAM,GAAG;;;MAG1C,CAAC;IAEL,MAAM,CAAC,iBAAiB,gBAAgB,SAAS,GAAG,MAAM,QAAQ,GAAG,CAAC;QACpE,kIAAM,CAAC,UAAU,CAAC,OAAO,CAAC;YACxB,IAAI;gBAAC;aAAU;YACf,OAAO;gBAAE,GAAG,UAAU;gBAAE,SAAS;oBAAE,KAAK;gBAAK;gBAAG,WAAW;oBAAE,KAAK;gBAAW;YAAE;YAC/E,QAAQ;YACR,SAAS;gBAAE,QAAQ;oBAAE,SAAS;gBAAO;YAAE;YACvC,MAAM;QACR;QACA,kIAAM,CAAC,UAAU,CAAC,OAAO,CAAC;YACxB,IAAI;gBAAC;aAAS;YACd,OAAO;gBAAE,GAAG,UAAU;gBAAE,QAAQ;oBAAE,KAAK;gBAAK;gBAAG,WAAW;oBAAE,KAAK;gBAAW;YAAE;YAC9E,QAAQ;YACR,SAAS;gBAAE,QAAQ;oBAAE,QAAQ;gBAAO;YAAE;QACxC;QACA,kIAAM,CAAC,SAAS,CAAC,QAAQ,CAAC;YACxB,OAAO;YACP,MAAM;YACN,SAAS;gBAAE,aAAa;oBAAE,QAAQ;gBAAO;YAAE;YAC3C,SAAS;gBACP,QAAQ;oBAAE,QAAQ;wBAAE,aAAa;oBAAK;gBAAE;YAC1C;QACF;KACD;IAED,MAAM,aAAa;QACjB,gBAAgB,aAAa,GAAG,CAAC,CAAC,OAAS,CAAC;gBAC1C,MAAM,KAAK,IAAI,CAAC,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE;gBAC3C,QAAQ,OAAO,KAAK,KAAK;YAC3B,CAAC;QACD,cAAc,gBAAgB,GAAG,CAAC,CAAC,OAAS,CAAC;gBAC3C,SAAS,KAAK,OAAO,IAAI;gBACzB,QAAQ,KAAK,MAAM;YACrB,CAAC;QACD,YAAY,eAAe,GAAG,CAAC,CAAC,OAAS,CAAC;gBACxC,QAAQ,KAAK,MAAM,IAAI;gBACvB,QAAQ,KAAK,MAAM;YACrB,CAAC;QACD,cAAc,SAAS,GAAG,CAAC,CAAC,OAAS,CAAC;gBACpC,MAAM,KAAK,IAAI;gBACf,OAAO,KAAK,KAAK,IAAI,KAAK,IAAI;gBAC9B,QAAQ,KAAK,MAAM,CAAC,WAAW;YACjC,CAAC;IACH;IAEA,qBAAO,8OAAC,wJAAU;QAAC,MAAM;;;;;;AAC3B"}}]
}